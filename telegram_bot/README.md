# ü§ñ ILPO-TAXI Telegram Support Bot

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

Telegram-–±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ ILPO-TAXI. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Å–∞–π—Ç–æ–º –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å –ò–ò-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ –Ω–∞ –∂–∏–≤—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤.

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìã **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–µ–º –∑–∞—è–≤–æ–∫** —Å —Å–∞–π—Ç–∞
- üë®‚Äçüíº **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏** –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å–∞–º–∏
- üîÑ **–ê–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫** –¥–æ—Å—Ç—É–ø–Ω—ã–º –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
- üí¨ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–µ–±-—á–∞—Ç–æ–º** –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** —Ä–∞–±–æ—Ç—ã
- üîî **–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Framework:** aiogram 3.21.0
- **Database:** PostgreSQL 17 + SQLAlchemy 2.0
- **Cache:** Redis 7+
- **Migrations:** Alembic
- **Python:** 3.10+

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
alembic upgrade head
```

### 4. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
```bash
python telegram_bot/main.py
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
telegram_bot/
‚îú‚îÄ‚îÄ config/          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ models/          # –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ services/        # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ —Å–µ—Ä–≤–∏—Å—ã
‚îú‚îÄ‚îÄ handlers/        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ utils/           # –£—Ç–∏–ª–∏—Ç—ã –∏ —Ö–µ–ª–ø–µ—Ä—ã
‚îú‚îÄ‚îÄ main.py          # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞
‚îî‚îÄ‚îÄ README.md        # –≠—Ç–æ—Ç —Ñ–∞–π–ª

database/
‚îú‚îÄ‚îÄ migrations/      # –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic
‚îî‚îÄ‚îÄ alembic.ini      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
TELEGRAM_BOT_TOKEN=your_bot_token
DATABASE_URL=postgresql+asyncpg://user:pass@host:5432/db
REDIS_URL=redis://localhost:6379
ADMIN_IDS=123456789,987654321
MANAGER_IDS=111111111,222222222
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```bash
AUTO_ASSIGN_MANAGERS=true
MAX_ACTIVE_CHATS_PER_MANAGER=5
MANAGER_RESPONSE_TIME_LIMIT=300
```

## üìã –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –î–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤:
- `/start` - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `/online` - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á—É—é —Å–º–µ–Ω—É
- `/offline` - –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É
- `/applications` - –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫
- `/stats` - –õ–∏—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
- `/admin` - –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `/managers` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏
- `/reports` - –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∞–π—Ç–æ–º

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞—è–≤–∫–∏ —á–µ—Ä–µ–∑:
1. **API endpoint** `/api/signup` –≤ FastAPI
2. **–°–µ—Ä–≤–∏—Å –∑–∞—è–≤–æ–∫** —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ –ë–î
3. **–ê–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ** –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É
4. **Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º

## üí¨ –í–µ–±-—á–∞—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–ö–Ω–æ–ø–∫–∞ "–°–≤—è–∑–∞—Ç—å—Å—è —Å –∂–∏–≤—ã–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º":
1. **–ü–æ–∏—Å–∫** –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
2. **–°–æ–∑–¥–∞–Ω–∏–µ** —á–∞—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤ –ë–î
3. **–ü–µ—Ä–µ–¥–∞—á–∞ –∏—Å—Ç–æ—Ä–∏–∏** —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ —Å –ò–ò
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤ Telegram

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞
tail -f telegram_bot.log

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
journalctl -u ilpo-taxi-bot -f
```

### –ú–µ—Ç—Ä–∏–∫–∏ Redis
```bash
redis-cli keys "manager_status:*"
redis-cli keys "chat_assignment:*"
```

### PostgreSQL
```sql
SELECT status, COUNT(*) FROM applications GROUP BY status;
SELECT status, COUNT(*) FROM managers GROUP BY status;
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram ID –ø–æ whitelist
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ü–æ–¥—Ä–æ–±–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã](TELEGRAM_BOT_LOGIC.md)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ production](../start.md#telegram-–±–æ—Ç-–ø–æ–¥–¥–µ—Ä–∂–∫–∏)
- [–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](models/support_models.py)

## ü§ù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
```bash
alembic revision --autogenerate -m "Description"
alembic upgrade head
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
python -c "from telegram_bot.config.settings import validate_settings; validate_settings()"

# –¢–µ—Å—Ç –±–æ—Ç–∞
python telegram_bot/main.py --test
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ .env
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å PostgreSQL –∏ Redis
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–ê–≤—Ç–æ—Ä:** Senior Development Team  
**–ü—Ä–æ–µ–∫—Ç:** ILPO-TAXI Smart Support System 